{% set subactive = "charity_donations" %}
{% extends 'CharityBundle::layout.html.twig' %}
{% block title %}{{ parent() }} - Modifier une donation {% endblock %}
{% block content %}
    <div id="page_content">
        <div id="page_heading" data-uk-sticky="{ top: 48, media: 960 }">
            <h1>Charité - Modifier une donation</h1>
        </div>
        <div id="page_content_inner">
            <form class="uk-form-stacked" action="{{url('charity_donation_update_callback', {'id': donation.id})}}" method="POST">
                <div class="uk-grid" data-uk-grid-margin>
                    <div class="uk-width-large-1-3">
                        <div class="md-card">
                            <div class="md-card-toolbar">
                                <h3 class="md-card-toolbar-heading-text">
                                    Montant de la donation
                                </h3>
                            </div>
                            <div class="md-card-content">
                                <div class="uk-grid uk-margin-bottom">
                                    <div class="uk-width-medium-1-1">
                                        <label for="cause" class="uk-form-label">Action soutenu<span class="req">*</span></label>
                                        <select id="cause" data-md-selectize name="cause" required>
                                            <option value="{{donation.cause.id}}">{{donation.cause.name}}</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="uk-grid">
                                    <div class="uk-width-medium-1-1">
                                        <label for="total_amount" class="uk-form-label">Montant Total<span class="req">*</span></label>
                                        <input type="number" name="total_amount" id="total_amount" required class="md-input"  value="{{donation.totalAmount}}" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="md-card">
                            <div class="md-card-toolbar">
                                <h3 class="md-card-toolbar-heading-text">
                                    Infos du donateur
                                </h3>
                            </div>
                            <div class="md-card-content">
                                <div class="uk-grid">
                                    <div class="uk-width-medium-1-1">
                                        <label for="first_name" class="uk-form-label">Nom<span class="req">*</span></label>
                                        <input type="text" name="first_name" id="first_name" required class="md-input" value="{{donation.firstName}}"/>
                                    </div>
                                </div>
                                <div class="uk-grid">
                                    <div class="uk-width-medium-1-1">
                                        <label for="last_name" class="uk-form-label">Prénoms</label>
                                        <input type="text" name="last_name" id="last_name" class="md-input" value="{{donation.lastName}}"/>
                                    </div>
                                </div>
                                <div class="uk-grid">
                                    <div class="uk-width-medium-1-1">
                                        <label for="email" class="uk-form-label">Email</label>
                                        <input type="email" name="email" id="email" class="md-input" value="{{donation.email}}"/>
                                    </div>
                                </div>
                                <div class="uk-grid">
                                    <div class="uk-width-medium-1-1">
                                        <label for="phone" class="uk-form-label">Téléphone</label>
                                        <input type="text" name="phone" id="phone" class="md-input" value="{{donation.phone}}"/>
                                    </div>
                                </div>
                                <div class="uk-grid">
                                    <div class="uk-width-medium-1-1">
                                        <label for="address" class="uk-form-label">Adresse</label>
                                        <input type="text" name="address" id="address" class="md-input" value="{{donation.address}}"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="uk-width-large-2-3">
                        <div class="md-card">
                            <div class="md-card-toolbar">
                                <h3 class="md-card-toolbar-heading-text">
                                    Echélonnage de la donation
                                </h3>
                            </div>
                             <div class="md-card-content" id="listProducts">
                                {% set donationLines = donation.donationLines %}
                                {% if donationLines is not empty %}
                                    {% for i in 0..donationLines|length - 1 %}
                                        {% set donationLine = donation.donationLines[i] %}
                                        {% set number = i + 1 %}
                                        <div class="uk-grid uk-margin-bottom uk-margin-top" id="container_donation_line_{{number}}">
                                            <div class="uk-width-medium-1-4">
                                                <input class="md-input" type="text" name="donation_line_date_{{number}}" id="donation_line_date_{{number}}" data-uk-datepicker="{format:'DD-MM-YYYY'}" placeholder="Date" value="{{donationLine.donatedAt|date("d-m-Y")}}">
                                            </div>
                                            <div class="uk-width-medium-1-4">
                                                <input type="number" name="donation_line_amount_{{number}}" id="donation_line_amount_{{number}}" required class="md-input" placeholder="Montant" value="{{donationLine.amount}}" />
                                            </div>
                                            <div class="uk-width-medium-1-4 uk-margin-small-top">
                                                <select id="donation_line_status_{{number}}" data-md-selectize name="donation_line_status_{{number}}" required>
                                                    <option value="">Etat</option>
                                                    <option value="0" {% if donationLine.status == 0 %}selected{% endif %}>Intention</option>
                                                    <option value="1" {% if donationLine.status == 1 %}selected{% endif %}>Payé</option>
                                                </select>
                                            </div>
                                            <div class="uk-width-medium-1-4 uk-margin-small-top uk-text-right">
                                                <a href="#" data-tooltip title="Retirer la ligne" id="{{number}}" class="remove_line"><i class="md-icon material-icons">&#xE872;</i></a>
                                                <input type="hidden" id="donation_line_{{number}}" name="donation_line_{{number}}" value="{{donationLine.id}}">
                                            </div>
                                        </div>
                                    {% endfor %}
                                {% else %}
                                    <div class="uk-grid uk-margin-bottom" id="container_donation_line_1">
                                        <div class="uk-width-medium-1-4">
                                            <input class="md-input" type="text" name="donation_line_date_1" id="donation_line_date_1" data-uk-datepicker="{format:'DD-MM-YYYY'}" placeholder="Date">
                                        </div>
                                        <div class="uk-width-medium-1-4">
                                            <input type="number" name="donation_line_amount_1" id="donation_line_amount_1" required class="md-input" placeholder="Montant"/>
                                        </div>
                                        <div class="uk-width-medium-1-4 uk-margin-small-top">
                                            <select id="donation_line_status_1" data-md-selectize name="donation_line_status_1" required>
                                                <option value="">Etat</option>
                                                <option value="0">Intention</option>
                                                <option value="1">Payé</option>
                                            </select>
                                        </div>
                                        <div class="uk-width-medium-1-4 uk-margin-small-top uk-text-right">
                                            <a href="#" data-tooltip title="Retirer la ligne" id="1" class="remove_line"><i class="md-icon material-icons">&#xE872;</i></a>
                                            <input type="hidden" id="donation_line_1" value="">
                                        </div>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="uk-width-medium-1-12 uk-text-center">
                            <a href="#" class="md-btn md-btn-flat md-btn-flat-primary" id="add-donation-line">Ajouter un echelon</a>
                            <input type="hidden" id="add-new-donation-line-form" value="{{ url('charity_donation_add_line_form')}}">
                            <input type="hidden" name="count_form" id="count_form" class="md-input" value="{{donation.donationLines|length|default('1')}}" />
                        </div>
                    </div>
                </div>
                <div class="md-fab-wrapper">
                    <button class="md-fab md-fab-success" type="submit">
                        <i class="material-icons">&#xE161;</i>
                    </button>
                </div>
            </form>
        </div>
    </div>
{% endblock %}

{# {% block javascripts %}
    {{ parent() }}
    <script src="{{asset("bundles/admin/js/pages/forms_advanced.min.js")}}"></script>
    <script type="text/javascript">
        // Add donation line form
        $("#add-donation-line").click(function(e){
            e.preventDefault();
            var count = $("#count_form").val();
            count++;
            $("#count_form").val(count);
            $.get($('#add-new-donation-line-form').val() +'?count=' + count, function(data){
                $("#listProducts").append(data);
            })
        });

        // Remove donation line form
        $(".remove_line").click(function(e){
            e.preventDefault();
            $("#container_donation_line_" + $(this).attr('id')).fadeOut("fast");
        });

        // Remove donation line form
        $(".remove_line").click(function(e){
            e.preventDefault();
            var id = $(this).attr('id');
            var url = "{{url('charity_donation_update_callback', {'id': donation.id})}}";
            $.post(url, {lines_to_remove: $("#donation_line_" + id).val()}, function(){
                $("#container_donation_line_" + $(this).attr('id')).fadeOut("fast");
            })
            
        });
    </script>

{% endblock %} #}