{% trans_default_domain 'messages' %}

<div class="uk-modal-dialog">
    <div class="uk-modal-header">
        <h3>{{ "calendar.content.agenda.update"|trans }} <em>{{ agenda.name }}</em></h3>
    </div>
    {{ form_start(form, {'method': 'POST'}) }}
    <div class="uk-modal-body uk-margin-top">
        <div class="uk-margin-medium-bottom">
            <div class="uk-form-row">
                {{ form_label(form.name) }}
                {{ form_widget(form.name) }}
            </div>
            <div class="uk-form-row">
                {{ form_label(form.slug) }}
                {{ form_widget(form.slug) }}
            </div>
            <div class="uk-form-row">
                {{ form_label(form.visibility) }}
                {{ form_widget(form.visibility, {'id': 'visibility'}) }}
            </div>
            <div class="uk-form-row {% if agenda.visibility != "share" %}uk-hidden{% endif %}" id="members-container">
                <div>{{ form_label(form.memberList) }}</div>
                {{ form_widget(form.memberList, {'id': 'autocomplete-members'}) }}
                <input type="hidden" id="members-id" name="members" value="" />
                <input type="hidden" id="members-list-url" value="{{ url('admin_users') }}">
                <input type="hidden" id="members" value="{% for member in agenda.members %}{{ member.fullName }}, {% endfor %}"/>
            </div>
        </div>
    </div>
    <div class="uk-modal-footer uk-text-right">
        <button type="button" class="md-btn md-btn-flat uk-modal-close">{{ "button.close"|trans }}</button>
        {{ form_widget(form.create, {'id': 'save'}) }}
    </div>
    {{ form_end(form) }}
</div>
<script src="{{asset("bundles/admin/js/common.js")}}"></script>
<script src="{{asset("bundles/admin/js/uikit_custom.js")}}"></script>
<script src="{{asset("bundles/admin/js/kendoui_custom.js")}}"></script>
<script src="{{asset("bundles/admin/js/kendoui.js")}}"></script>
<script src="{{asset("bundles/admin/js/slugify.js")}}"></script>

<script type="text/javascript">
    altair_forms.init();
    altair_md.init();
    $("#autocomplete-members").html($("#members").val());
    // Shared agenda
    $("#visibility").change(function(e){
        if ($(this).val() == "share"){
            $("#members-container").removeClass('uk-hidden');
        }else {
            $("#members-container").addClass('uk-hidden');
        }
    });

    // AutoComplete
    $("#autocomplete-members").kendoAutoComplete({
        minLength: 2,
        filter : "contains",
        separator: ", ",
        dataValueField : "id",
        dataTextField : "fullName",
        template: 
            '<div class="k-list-wrapper">'+
            '<span class="k-state-default k-list-wrapper-content">' +
            '<p>#: data.fullName #(#: data.email #)</p>' +
            '</span>' +
            '</div>',
        footerTemplate: 'Total #: instance.dataSource.total() #',
        dataSource: {
            transport: {
                read: {
                    method: 'POST',
                    dataType: "json",
                    url: $("#members-list-url").val()
                }
            }
        },
        select: function (e){ 
            var selectedOne =  this.dataItem(e.item.index());
            $("#members-id").val(selectedOne.id);
        },
        height: 200
    }).data("kendoAutoComplete");
</script>